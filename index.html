<html>
<head>
	<link rel="stylesheet" type="text/css" href="http://metricsgraphicsjs.org/css/metricsgraphics.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="http://kovalent.co/mksht/dollaraday/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/2.3.0/metricsgraphics.js"></script>

	<title>Hey</title>
</head>
<body>
	<p><a href="https://docs.google.com/forms/d/1ejZAk8NJhe_dTJbabLPglieQmf68L1K7F03Ilh42PyQ/viewform">Enter more data.</a></p>

	<div id="chart">
	</div>

	<script>
	// $.ajax({
	//   url:'https://spreadsheets.google.com/feeds/list/1CVtxktOSZxUmDCR8zEdGA5xEdNpB2sK2MtSXC-JIdOU/1/public/basic?alt=json-in-script&callback=JSON_CALLBACK',
	//   success: function(data){
	//     console.log(data);
	//   }
	// });

	var JSONURL = 'https://spreadsheets.google.com/feeds/list/1CVtxktOSZxUmDCR8zEdGA5xEdNpB2sK2MtSXC-JIdOU/1/public/basic?alt=json';

	function drawChart(rows){
    
	    console.log(rows);
	    
	    for (var i = 0; i < rows.length; i++){
	        rows[i].timestamp = new Date(rows[i].timestamp);
	    }
	    
	    MG.data_graphic({
	      title: "Odometer Reading vs. Date",
	      data: rows,
	      width: 400,
	      height: 250,
	      target: "#chart",
	      x_accessor: "timestamp",
	      y_accessor: "odometer",
	      interpolate: "monotone"
	    });
	}

	function callback(data){
	    var rows = [];
	    var cells = data.feed.entry;
	    
	    for (var i = 0; i < cells.length; i++){
	        var rowObj = {};
	        rowObj.timestamp = cells[i].title.$t;
	        var rowCols = cells[i].content.$t.split(',');
	        for (var j = 0; j < rowCols.length; j++){
	            var keyVal = rowCols[j].split(':');
	            rowObj[keyVal[0].trim()] = keyVal[1].trim();
	        }
	        rows.push(rowObj);
	    }
	    
	    var raw = document.createElement('p');
	    raw.innerText = JSON.stringify(rows);
	    document.body.appendChild(raw);

	    drawChart(rows);
	}

	$(document).ready(function(){
	    
	    $.ajax({
	        url:JSONURL,
	        success: function(data){
	            callback(data);
	        }
	    });

	});

	</script>

</body>
</html>

